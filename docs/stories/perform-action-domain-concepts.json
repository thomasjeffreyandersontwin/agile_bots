{
  "sub_epic": "Perform Action",
  "stories_analyzed": [
    "Render Story Graph using Story Graph API",
    "Build Story Graph Using API",
    "Build Story Graph With CLI"
  ],
  "bounded_context": "Story Graph",
  "domain_concepts": [
    {
      "name": "StoryNode",
      "scope": "global",
      "module": "story_graph.nodes",
      "inherits_from": "ABC",
      "description": "Abstract base class for all story map node types providing common traversal, visitor acceptance, and persistence operations",
      "responsibilities": [
        {
          "name": "traverse children",
          "collaborators": ["StoryNode"],
          "description": "Iterate over child nodes in the story hierarchy"
        },
        {
          "name": "accept visitor",
          "collaborators": ["StoryRenderVisitor"],
          "description": "Allow visitor to process this node using visitor pattern"
        },
        {
          "name": "rename node",
          "collaborators": ["StoryMap"],
          "description": "Update node name and persist changes to story graph"
        },
        {
          "name": "delete node",
          "collaborators": ["Parent"],
          "description": "Remove this node from parent's children collection"
        },
        {
          "name": "move node",
          "collaborators": ["Parent", "StoryMap"],
          "description": "Reposition node within hierarchy and update order"
        },
        {
          "name": "persist changes",
          "collaborators": ["StoryMap"],
          "description": "Trigger story_graph dict update when node changes"
        }
      ]
    },
    {
      "name": "Epic",
      "scope": "global",
      "module": "story_graph.nodes",
      "inherits_from": "StoryNode",
      "description": "Top-level story map node containing sub-epics and stories",
      "responsibilities": [
        {
          "name": "contain sub-epics",
          "collaborators": ["SubEpic"],
          "description": "Maintain collection of sub-epic children"
        },
        {
          "name": "create sub-epic",
          "collaborators": ["SubEpic", "StoryMap"],
          "description": "Add new sub-epic as child and update story graph"
        },
        {
          "name": "accept visitor",
          "collaborators": ["StoryRenderVisitor"],
          "description": "Process epic-specific rendering logic via visitor"
        }
      ]
    },
    {
      "name": "SubEpic",
      "scope": "global",
      "module": "story_graph.nodes",
      "inherits_from": "StoryNode",
      "description": "Mid-level story map node representing features or capabilities",
      "responsibilities": [
        {
          "name": "contain sub-epics",
          "collaborators": ["SubEpic"],
          "description": "Maintain nested sub-epics for deeper hierarchy"
        },
        {
          "name": "contain stories",
          "collaborators": ["Story"],
          "description": "Maintain collection of story children"
        },
        {
          "name": "create child",
          "collaborators": ["SubEpic", "Story", "StoryMap"],
          "description": "Add sub-epic or story as child based on hierarchy rules"
        },
        {
          "name": "validate hierarchy",
          "collaborators": [],
          "description": "Enforce no mixing of sub-epics and stories at same level"
        }
      ]
    },
    {
      "name": "Story",
      "scope": "global",
      "module": "story_graph.nodes",
      "inherits_from": "StoryNode",
      "description": "Leaf node representing user stories with acceptance criteria",
      "responsibilities": [
        {
          "name": "contain acceptance criteria",
          "collaborators": [],
          "description": "Maintain list of AC strings"
        },
        {
          "name": "contain scenarios",
          "collaborators": ["Scenario"],
          "description": "Maintain collection of test scenarios"
        },
        {
          "name": "accept visitor",
          "collaborators": ["StoryRenderVisitor"],
          "description": "Process story-specific rendering logic via visitor"
        }
      ]
    },
    {
      "name": "StoryMap",
      "scope": "global",
      "module": "story_graph.nodes",
      "inherits_from": "StoryNode",
      "description": "Root aggregate managing story graph hierarchy, persistence, and API operations",
      "responsibilities": [
        {
          "name": "contain epics",
          "collaborators": ["Epic"],
          "description": "Maintain top-level epic collection"
        },
        {
          "name": "create epic",
          "collaborators": ["Epic"],
          "description": "Add new epic to story graph"
        },
        {
          "name": "create epic from dict",
          "collaborators": ["Epic", "SubEpic", "Story"],
          "description": "Batch create hierarchy from dictionary notation"
        },
        {
          "name": "save story graph",
          "collaborators": [],
          "description": "Persist story_graph dict to JSON file"
        },
        {
          "name": "load story graph",
          "collaborators": ["Epic", "SubEpic", "Story"],
          "description": "Rebuild domain model from JSON file"
        },
        {
          "name": "accept visitor",
          "collaborators": ["StoryRenderVisitor"],
          "description": "Process entire story map via visitor pattern"
        }
      ]
    },
    {
      "name": "StoryRenderVisitor",
      "scope": "global",
      "module": "story_graph.renderers",
      "inherits_from": "ABC",
      "description": "Abstract visitor base class for rendering story graph to different formats following visitor pattern",
      "responsibilities": [
        {
          "name": "visit story map",
          "collaborators": ["StoryMap"],
          "description": "Process root story map node and initialize rendering"
        },
        {
          "name": "visit epic",
          "collaborators": ["Epic", "RenderedNode"],
          "description": "Render epic node with format-specific layout"
        },
        {
          "name": "visit sub epic",
          "collaborators": ["SubEpic", "RenderedNode"],
          "description": "Render sub-epic node with format-specific layout"
        },
        {
          "name": "visit story",
          "collaborators": ["Story", "RenderedNode"],
          "description": "Render story node with format-specific layout"
        },
        {
          "name": "traverse children",
          "collaborators": ["StoryNode"],
          "description": "Recursively visit child nodes in hierarchy"
        }
      ]
    },
    {
      "name": "DrawIORenderer",
      "scope": "local",
      "module": "synchronizers.story_io.renderers",
      "inherits_from": "StoryRenderVisitor",
      "description": "Concrete visitor rendering story graph to DrawIO diagram format",
      "responsibilities": [
        {
          "name": "initialize file",
          "collaborators": [],
          "description": "Create DrawIO XML document structure"
        },
        {
          "name": "create epic shape",
          "collaborators": ["Epic", "Position"],
          "description": "Render epic as DrawIO rectangle with specific styling"
        },
        {
          "name": "create sub epic shape",
          "collaborators": ["SubEpic", "Position"],
          "description": "Render sub-epic as DrawIO rectangle with specific styling"
        },
        {
          "name": "create story shape",
          "collaborators": ["Story", "Position"],
          "description": "Render story as DrawIO rectangle with specific styling"
        },
        {
          "name": "persist positions",
          "collaborators": ["Position"],
          "description": "Save layout data to position JSON file"
        }
      ]
    },
    {
      "name": "MarkdownRenderer",
      "scope": "local",
      "module": "story_graph.renderers",
      "inherits_from": "StoryRenderVisitor",
      "description": "Concrete visitor rendering story graph to markdown format",
      "responsibilities": [
        {
          "name": "render epic as heading",
          "collaborators": ["Epic"],
          "description": "Output epic as markdown heading level 1"
        },
        {
          "name": "render sub epic as heading",
          "collaborators": ["SubEpic"],
          "description": "Output sub-epic as markdown heading level 2"
        },
        {
          "name": "render story as list item",
          "collaborators": ["Story"],
          "description": "Output story as markdown bullet point"
        },
        {
          "name": "write to file",
          "collaborators": [],
          "description": "Persist markdown content to .md file"
        }
      ]
    },
    {
      "name": "TextRenderer",
      "scope": "local",
      "module": "story_graph.renderers",
      "inherits_from": "StoryRenderVisitor",
      "description": "Concrete visitor rendering story graph to plain text outline format",
      "responsibilities": [
        {
          "name": "render with indentation",
          "collaborators": ["StoryNode"],
          "description": "Output nodes with hierarchical indentation"
        },
        {
          "name": "add node prefix",
          "collaborators": [],
          "description": "Prefix nodes with (E), (S), (AC) markers"
        },
        {
          "name": "write to file",
          "collaborators": [],
          "description": "Persist text content to .txt file"
        }
      ]
    },
    {
      "name": "RenderedNode",
      "scope": "global",
      "module": "story_graph.rendered",
      "inherits_from": "StoryNode",
      "description": "Decorator wrapping StoryNode with rendering metadata (position, layout, formatting)",
      "responsibilities": [
        {
          "name": "delegate to wrapped node",
          "collaborators": ["StoryNode"],
          "description": "Forward core operations to underlying StoryNode"
        },
        {
          "name": "store position data",
          "collaborators": ["Position"],
          "description": "Maintain x, y coordinates for rendered output"
        },
        {
          "name": "store layout data",
          "collaborators": ["Layout"],
          "description": "Maintain width, height, spacing information"
        },
        {
          "name": "store formatting data",
          "collaborators": ["Format"],
          "description": "Maintain colors, fonts, styling information"
        },
        {
          "name": "trigger re-render",
          "collaborators": ["StoryRenderVisitor"],
          "description": "Accept visitor again when node changes"
        }
      ]
    },
    {
      "name": "Position",
      "scope": "global",
      "module": "story_graph.layout",
      "description": "Value object representing x, y coordinates in rendered output",
      "responsibilities": [
        {
          "name": "calculate relative position",
          "collaborators": ["Parent"],
          "description": "Compute position relative to parent node"
        },
        {
          "name": "serialize to dict",
          "collaborators": [],
          "description": "Convert position to JSON-serializable format"
        }
      ]
    },
    {
      "name": "Layout",
      "scope": "global",
      "module": "story_graph.layout",
      "description": "Value object representing size and spacing information",
      "responsibilities": [
        {
          "name": "calculate node dimensions",
          "collaborators": [],
          "description": "Determine width and height based on content"
        },
        {
          "name": "calculate spacing",
          "collaborators": ["Parent", "Siblings"],
          "description": "Determine spacing between nodes in hierarchy"
        }
      ]
    },
    {
      "name": "CLIAdapter",
      "scope": "local",
      "module": "cli.story_graph_commands",
      "description": "CLI command adapter wrapping StoryMap API for AI and human use",
      "responsibilities": [
        {
          "name": "parse create epic command",
          "collaborators": ["StoryMap"],
          "description": "Convert CLI syntax to StoryMap.create_epic call"
        },
        {
          "name": "parse create sub epic command",
          "collaborators": ["SubEpic"],
          "description": "Convert CLI syntax to create_child call"
        },
        {
          "name": "parse create story command",
          "collaborators": ["Story"],
          "description": "Convert CLI syntax to create_story call"
        },
        {
          "name": "parse create from json command",
          "collaborators": ["StoryMap"],
          "description": "Convert CLI syntax to create_epic_from_dict call"
        },
        {
          "name": "parse save command",
          "collaborators": ["StoryMap"],
          "description": "Convert CLI syntax to save call"
        },
        {
          "name": "return validation errors",
          "collaborators": [],
          "description": "Convert exceptions to CLI error messages"
        }
      ]
    }
  ],
  "domain_rules": [
    "StoryNode provides abstract interface - all node types must implement accept(visitor)",
    "Hierarchy rules enforced by SubEpic - no mixing sub-epics and stories at same level",
    "StoryMap owns persistence - nodes trigger updates but don't directly save",
    "Visitor pattern enables multiple output formats without modifying node classes",
    "RenderedNode uses decorator pattern - wraps existing nodes without changing their interface",
    "Position and Layout are value objects - immutable and compared by value",
    "CLIAdapter translates syntax but delegates all logic to StoryMap API"
  ],
  "collaborator_relationships": {
    "StoryNode_to_StoryRenderVisitor": "Visitor pattern - nodes accept visitors for rendering",
    "StoryRenderVisitor_to_RenderedNode": "Visitor creates decorated nodes with layout data",
    "RenderedNode_to_StoryNode": "Decorator pattern - wraps and delegates to underlying node",
    "StoryMap_to_Persistence": "Aggregate root - only StoryMap persists to JSON",
    "CLIAdapter_to_StoryMap": "Adapter pattern - translates CLI to API calls"
  }
}
